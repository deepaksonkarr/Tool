<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free online image cropper tool. Crop images to any size or aspect ratio with precision controls. Optimize and compress images for web or social media.">
    <meta name="keywords" content="image cropper, photo crop tool, image resizer, photo editor, image optimizer">
    <meta name="author" content="Deepak Sonkar">
    <meta name="robots" content="index, follow">
    <title>Precision Image Cropper | Free Online Tool</title>
    <link rel="canonical" href="https://yourdomain.com/image-cropper" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_PUBLISHER_ID" crossorigin="anonymous"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-light: #e6f0ff;
            --secondary-color: #f8f9fa;
            --dark-color: #212529;
            --gray-color: #6c757d;
            --light-color: #ffffff;
            --border-color: #dee2e6;
            --success-color: #28a745;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --border-radius-sm: 6px;
            --border-radius-md: 10px;
            --border-radius-lg: 14px;
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background-color: var(--secondary-color);
            padding: 0;
            margin: 0;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #3a0ca3 100%);
            color: var(--light-color);
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50px;
            right: -50px;
            width: 200px;
            height: 200px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 50%;
        }
        
        header::after {
            content: "";
            position: absolute;
            bottom: -80px;
            left: -80px;
            width: 300px;
            height: 300px;
            background-color: rgba(255,255,255,0.05);
            border-radius: 50%;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        
        .ad-container {
            background-color: var(--light-color);
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow-sm);
            padding: 1rem;
            margin: 1.5rem 0;
            text-align: center;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px dashed var(--border-color);
        }
        
        .tool-container {
            display: flex;
            flex-direction: column;
            background-color: var(--light-color);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .tool-header {
            background-color: var(--dark-color);
            color: var(--light-color);
            padding: 1.25rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .tool-header i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .tool-body {
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
        }
        
        @media (min-width: 992px) {
            .tool-body {
                flex-direction: row;
                gap: 1.5rem;
            }
        }
        
        .image-section {
            flex: 1.5;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .controls-section {
            flex: 1;
            padding: 1rem;
        }
        
        @media (min-width: 992px) {
            .controls-section {
                border-left: 1px solid var(--border-color);
            }
        }
        
        .upload-area {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius-md);
            background-color: var(--secondary-color);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 1.5rem;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
        }
        
        .upload-area i {
            font-size: 2.5rem;
            color: var(--gray-color);
            margin-bottom: 1rem;
        }
        
        .upload-area.active {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
        }
        
        .upload-area.active i {
            color: var(--primary-color);
        }
        
        .crop-container {
            width: 100%;
            max-width: 600px;
            height: 400px;
            position: relative;
            overflow: hidden;
            border-radius: var(--border-radius-md);
            border: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
            background-color: #f1f3f5;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #image-preview {
            max-width: 100%;
            max-height: 100%;
            display: block;
            object-fit: contain;
        }
        
        .crop-box {
            position: absolute;
            border: 2px solid var(--primary-color);
            cursor: move;
            box-sizing: border-box;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
            z-index: 1;
        }
        
        .crop-handle {
            width: 12px;
            height: 12px;
            background-color: var(--primary-color);
            position: absolute;
            z-index: 2;
            border: 2px solid var(--light-color);
            border-radius: 50%;
        }
        
        .handle-nw { top: -6px; left: -6px; cursor: nw-resize; }
        .handle-ne { top: -6px; right: -6px; cursor: ne-resize; }
        .handle-sw { bottom: -6px; left: -6px; cursor: sw-resize; }
        .handle-se { bottom: -6px; right: -6px; cursor: se-resize; }
        
        .control-group {
            margin-bottom: 1.75rem;
        }
        
        .control-group h3 {
            margin-bottom: 1rem;
            color: var(--dark-color);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-group h3 i {
            color: var(--primary-color);
            font-size: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--dark-color);
        }
        
        input[type="range"], 
        input[type="number"],
        select {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.95rem;
            transition: var(--transition);
        }
        
        input[type="range"] {
            padding: 0;
            -webkit-appearance: none;
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: 2px solid var(--light-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }
        
        .input-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .input-group > div {
            flex: 1;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .checkbox-group input {
            width: auto;
            margin: 0;
        }
        
        .checkbox-group label {
            margin: 0;
            font-weight: normal;
        }
        
        button {
            background-color: var(--primary-color);
            color: var(--light-color);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: var(--transition);
            margin-right: 0.75rem;
            margin-bottom: 0.75rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-sm);
        }
        
        button:hover {
            background-color: #3a56e0;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background-color: var(--gray-color);
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--dark-color);
            box-shadow: none;
        }
        
        .btn-outline:hover {
            background-color: var(--secondary-color);
            transform: none;
            box-shadow: none;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }
        
        .result-container {
            display: none;
            margin-top: 2rem;
            padding: 2rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            background-color: var(--light-color);
            box-shadow: var(--shadow-md);
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .result-image-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .result-image {
            max-width: 100%;
            height: auto;
            max-height: 400px;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-sm);
            margin-bottom: 1.5rem;
        }
        
        .result-info {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .info-box {
            flex: 1;
            min-width: 150px;
            padding: 1rem;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius-sm);
            text-align: center;
        }
        
        .info-box h4 {
            font-size: 0.8rem;
            color: var(--gray-color);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .info-box p {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark-color);
        }
        
        .result-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .aspect-ratio-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        
        .aspect-ratio-btn {
            padding: 0.5rem 1rem;
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.85rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .aspect-ratio-btn i {
            font-size: 0.9rem;
        }
        
        .aspect-ratio-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .aspect-ratio-btn.active {
            background-color: var(--primary-color);
            color: var(--light-color);
            border-color: var(--primary-color);
        }
        
        footer {
            text-align: center;
            padding: 3rem 1rem;
            background-color: var(--dark-color);
            color: var(--light-color);
            margin-top: 3rem;
        }
        
        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin: 1.5rem 0;
            flex-wrap: wrap;
        }
        
        .footer-links a {
            color: var(--light-color);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-links a:hover {
            color: var(--primary-color);
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .social-links a {
            color: var(--light-color);
            font-size: 1.25rem;
            transition: var(--transition);
        }
        
        .social-links a:hover {
            color: var(--primary-color);
            transform: translateY(-3px);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .tool-header {
                padding: 1rem;
            }
            
            .tool-body {
                padding: 1rem;
            }
            
            .image-section, .controls-section {
                padding: 0.5rem;
            }
            
            .crop-container {
                height: 300px;
            }
            
            .result-container {
                padding: 1.5rem;
            }
            
            .result-info {
                flex-direction: column;
                gap: 0.75rem;
            }
        }
        
        @media (max-width: 576px) {
            header {
                padding: 1.5rem 1rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .upload-area {
                padding: 1.5rem;
            }
            
            .crop-container {
                height: 250px;
            }
            
            .input-group {
                flex-direction: column;
                gap: 0;
            }
            
            .result-actions {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .result-actions button {
                width: 100%;
                margin-right: 0;
            }
        }
        
        /* Loading spinner */
        .spinner {
            display: none;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--light-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark-color);
            color: var(--light-color);
            text-align: center;
            border-radius: var(--border-radius-sm);
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Precision Image Cropper</h1>
            <p>Crop and optimize your images with pixel-perfect accuracy</p>
        </div>
    </header>
    
    <div class="container">
        <!-- Top Ad Banner -->
        <div class="ad-container">
            <!-- Replace with your AdSense ad unit -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-app-pub-2231346966570584/3996094487"
                 data-ad-slot="YOUR_AD_SLOT_ID"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <div class="tool-container">
            <div class="tool-header">
                <i class="fas fa-crop-alt"></i>
                <h2>Image Cropping Tool</h2>
            </div>
            <div class="tool-body">
                <div class="image-section">
                    <div class="upload-area" id="upload-area">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Drag & drop your image here</p>
                        <p>or</p>
                        <button id="upload-btn"><i class="fas fa-folder-open"></i> Browse Files</button>
                        <input type="file" id="image-upload" accept="image/*" hidden>
                    </div>
                    
                    <div class="crop-container" id="crop-container">
                        <img id="image-preview" src="" alt="Image to crop">
                        <div class="crop-box" id="crop-box">
                            <div class="crop-handle handle-nw"></div>
                            <div class="crop-handle handle-ne"></div>
                            <div class="crop-handle handle-sw"></div>
                            <div class="crop-handle handle-se"></div>
                        </div>
                    </div>
                </div>
                
                <div class="controls-section">
                    <div class="control-group">
                        <h3><i class="fas fa-sliders-h"></i> Crop Settings</h3>
                        <div class="aspect-ratio-buttons">
                            <button class="aspect-ratio-btn active" data-ratio="0">
                                <i class="fas fa-vector-square"></i> Free
                            </button>
                            <button class="aspect-ratio-btn" data-ratio="1">
                                <i class="fas fa-square"></i> 1:1
                            </button>
                            <button class="aspect-ratio-btn" data-ratio="1.777">
                                <i class="fas fa-desktop"></i> 16:9
                            </button>
                            <button class="aspect-ratio-btn" data-ratio="1.333">
                                <i class="fas fa-tablet-alt"></i> 4:3
                            </button>
                            <button class="aspect-ratio-btn" data-ratio="0.666">
                                <i class="fas fa-mobile-alt"></i> 2:3
                            </button>
                        </div>
                        
                        <div class="input-group">
                            <div>
                                <label for="crop-width">Width (px)</label>
                                <input type="number" id="crop-width" min="1" value="300">
                            </div>
                            <div>
                                <label for="crop-height">Height (px)</label>
                                <input type="number" id="crop-height" min="1" value="300">
                            </div>
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="lock-aspect" checked>
                            <label for="lock-aspect">Lock aspect ratio</label>
                            <div class="tooltip">
                                <i class="fas fa-info-circle" style="color: var(--gray-color);"></i>
                                <span class="tooltiptext">When locked, changing width will automatically adjust height to maintain the aspect ratio</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <h3><i class="fas fa-file-image"></i> Output Settings</h3>
                        <label for="output-format">Output Format</label>
                        <select id="output-format">
                            <option value="original">Original Format</option>
                            <option value="jpeg">JPEG (Best for photos)</option>
                            <option value="png">PNG (Lossless quality)</option>
                            <option value="webp">WebP (Modern format)</option>
                        </select>
                        
                        <label for="quality">Quality: <span id="quality-value">80%</span></label>
                        <input type="range" id="quality" min="10" max="100" value="80">
                    </div>
                    
                    <div class="control-group">
                        <button id="crop-btn" class="btn-success">
                            <i class="fas fa-crop-alt"></i> Crop Image
                        </button>
                        <button id="reset-btn" class="btn-secondary">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="result-container" id="result-container">
            <div class="result-header">
                <h3><i class="fas fa-check-circle" style="color: var(--success-color);"></i> Cropped Image Ready</h3>
                <button id="new-crop-btn" class="btn-outline btn-sm">
                    <i class="fas fa-arrow-left"></i> New Crop
                </button>
            </div>
            
            <div class="result-image-container">
                <img id="result-image" class="result-image" src="" alt="Cropped image result">
                
                <div class="result-info">
                    <div class="info-box">
                        <h4>File Format</h4>
                        <p id="result-format">JPEG</p>
                    </div>
                    <div class="info-box">
                        <h4>Dimensions</h4>
                        <p id="result-dimensions">300 Ã— 300 px</p>
                    </div>
                    <div class="info-box">
                        <h4>File Size</h4>
                        <p id="result-size">45 KB</p>
                    </div>
                </div>
            </div>
            
            <div class="result-actions">
                <button id="download-btn" class="download-btn">
                    <i class="fas fa-download"></i> Download Image
                </button>
                <button id="copy-btn" class="btn-secondary">
                    <i class="fas fa-copy"></i> Copy to Clipboard
                </button>
                <button id="share-btn" class="btn-outline">
                    <i class="fas fa-share-alt"></i> Share
                </button>
            </div>
        </div>
        
        <!-- Middle Ad Banner -->
        <div class="ad-container">
            <!-- Replace with your AdSense ad unit -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-app-pub-2231346966570584/1764086341"
                 data-ad-slot="YOUR_AD_SLOT_ID"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>
    
    <footer>
        <div class="footer-content">
            <p>&copy; <span id="year"></span> Image Cropper Tool. All rights reserved.</p>
            <div class="footer-links">
                <a href="/privacy">Privacy Policy</a>
                <a href="/terms">Terms of Service</a>
                <a href="/contact">Contact Us</a>
                <a href="/about">About</a>
                <a href="/faq">FAQ</a>
            </div>
            <div class="social-links">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-pinterest"></i></a>
            </div>
            <p>Free online tool for cropping and optimizing images. No registration required.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set current year in footer
            document.getElementById('year').textContent = new Date().getFullYear();
            
            // Initialize variables
            const imageUpload = document.getElementById('image-upload');
            const uploadBtn = document.getElementById('upload-btn');
            const uploadArea = document.getElementById('upload-area');
            const cropBtn = document.getElementById('crop-btn');
            const resetBtn = document.getElementById('reset-btn');
            const downloadBtn = document.getElementById('download-btn');
            const copyBtn = document.getElementById('copy-btn');
            const shareBtn = document.getElementById('share-btn');
            const newCropBtn = document.getElementById('new-crop-btn');
            const imagePreview = document.getElementById('image-preview');
            const cropContainer = document.getElementById('crop-container');
            const cropBox = document.getElementById('crop-box');
            const cropWidth = document.getElementById('crop-width');
            const cropHeight = document.getElementById('crop-height');
            const lockAspect = document.getElementById('lock-aspect');
            const qualitySlider = document.getElementById('quality');
            const qualityValue = document.getElementById('quality-value');
            const outputFormat = document.getElementById('output-format');
            const resultContainer = document.getElementById('result-container');
            const resultImage = document.getElementById('result-image');
            const resultFormat = document.getElementById('result-format');
            const resultDimensions = document.getElementById('result-dimensions');
            const resultSize = document.getElementById('result-size');
            const aspectRatioBtns = document.querySelectorAll('.aspect-ratio-btn');
            
            let currentAspectRatio = 0;
            let isDragging = false;
            let isResizing = false;
            let startX, startY;
            let startWidth, startHeight;
            let startLeft, startTop;
            let activeHandle = null;
            let originalImage = null;
            let originalImageData = null;
            let croppedImageData = null;
            
            // Event listeners
            uploadBtn.addEventListener('click', () => imageUpload.click());
            uploadArea.addEventListener('click', () => imageUpload.click());
            imageUpload.addEventListener('change', handleImageUpload);
            cropBtn.addEventListener('click', cropImage);
            resetBtn.addEventListener('click', resetTool);
            downloadBtn.addEventListener('click', downloadImage);
            copyBtn.addEventListener('click', copyToClipboard);
            shareBtn.addEventListener('click', shareImage);
            newCropBtn.addEventListener('click', () => {
                resultContainer.style.display = 'none';
            });
            
            qualitySlider.addEventListener('input', () => {
                qualityValue.textContent = `${qualitySlider.value}%`;
            });
            
            // Aspect ratio buttons
            aspectRatioBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    aspectRatioBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentAspectRatio = parseFloat(this.dataset.ratio);
                    
                    if (currentAspectRatio > 0) {
                        lockAspect.checked = true;
                        updateCropDimensionsForAspectRatio();
                    }
                });
            });
            
            // Lock aspect ratio change
            lockAspect.addEventListener('change', function() {
                if (this.checked && currentAspectRatio > 0) {
                    updateCropDimensionsForAspectRatio();
                }
            });
            
            // Crop dimension changes
            cropWidth.addEventListener('input', updateCropBoxSize);
            cropHeight.addEventListener('input', updateCropBoxSize);
            
            // Drag and drop functionality
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('active');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('active');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('active');
                if (e.dataTransfer.files.length) {
                    imageUpload.files = e.dataTransfer.files;
                    handleImageUpload();
                }
            });
            
            // Crop box interaction
            cropBox.addEventListener('mousedown', startDrag);
            document.querySelectorAll('.crop-handle').forEach(handle => {
                handle.addEventListener('mousedown', startResize);
            });
            
            document.addEventListener('mousemove', handleMove);
            document.addEventListener('mouseup', stopInteraction);
            
            // Touch events for mobile
            cropBox.addEventListener('touchstart', handleTouchStart);
            document.querySelectorAll('.crop-handle').forEach(handle => {
                handle.addEventListener('touchstart', handleTouchStart);
            });
            
            document.addEventListener('touchmove', handleTouchMove);
            document.addEventListener('touchend', stopInteraction);
            
            // Initialize crop box
            resetTool();
            
            // Functions
            function handleImageUpload() {
                if (imageUpload.files && imageUpload.files[0]) {
                    const file = imageUpload.files[0];
                    if (!file.type.match('image.*')) {
                        alert('Please select an image file');
                        return;
                    }
                    
                    // Show loading state
                    uploadArea.innerHTML = '<div class="spinner"></div><p>Loading image...</p>';
                    const spinner = uploadArea.querySelector('.spinner');
                    spinner.style.display = 'block';
                    
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        imagePreview.src = e.target.result;
                        originalImageData = e.target.result;
                        
                        imagePreview.onload = function() {
                            originalImage = {
                                width: this.naturalWidth,
                                height: this.naturalHeight,
                                src: this.src
                            };
                            
                            // Hide upload area and show image
                            uploadArea.style.display = 'none';
                            cropContainer.style.display = 'flex';
                            
                            // Initialize crop box
                            const containerWidth = cropContainer.clientWidth;
                            const containerHeight = cropContainer.clientHeight;
                            
                            // Calculate initial crop size (50-80% of container or image, whichever is smaller)
                            const initWidth = Math.min(
                                Math.max(200, Math.min(containerWidth, originalImage.width) * 0.7),
                                containerWidth * 0.8,
                                originalImage.width
                            );
                            
                            const initHeight = Math.min(
                                Math.max(200, Math.min(containerHeight, originalImage.height) * 0.7),
                                containerHeight * 0.8,
                                originalImage.height
                            );
                            
                            cropWidth.value = Math.round(initWidth);
                            cropHeight.value = Math.round(initHeight);
                            
                            // Center crop box
                            const left = (containerWidth - initWidth) / 2;
                            const top = (containerHeight - initHeight) / 2;
                            
                            cropBox.style.width = `${initWidth}px`;
                            cropBox.style.height = `${initHeight}px`;
                            cropBox.style.left = `${left}px`;
                            cropBox.style.top = `${top}px`;
                            
                            // Update aspect ratio to match initial crop
                            currentAspectRatio = initWidth / initHeight;
                        };
                    };
                    
                    reader.onerror = function() {
                        alert('Error reading file. Please try another image.');
                        resetUploadArea();
                    };
                    
                    reader.readAsDataURL(file);
                }
            }
            
            function resetUploadArea() {
                uploadArea.innerHTML = `
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Drag & drop your image here</p>
                    <p>or</p>
                    <button id="upload-btn"><i class="fas fa-folder-open"></i> Browse Files</button>
                `;
                document.getElementById('upload-btn').addEventListener('click', () => imageUpload.click());
                uploadArea.style.display = 'flex';
            }
            
            function updateCropDimensionsForAspectRatio() {
                if (currentAspectRatio > 0) {
                    const width = parseInt(cropWidth.value);
                    const newHeight = Math.round(width / currentAspectRatio);
                    cropHeight.value = newHeight;
                    updateCropBoxSize();
                }
            }
            
            function updateCropBoxSize() {
                if (!originalImage) return;
                
                let width = parseInt(cropWidth.value);
                let height = parseInt(cropHeight.value);
                
                // Validate dimensions
                if (isNaN(width) width = 100;
                if (isNaN(height)) height = 100;
                
                if (width < 10) width = 10;
                if (height < 10) height = 10;
                
                cropWidth.value = width;
                cropHeight.value = height;
                
                if (lockAspect.checked && currentAspectRatio > 0) {
                    const newHeight = Math.round(width / currentAspectRatio);
                    cropHeight.value = newHeight;
                    height = newHeight;
                }
                
                cropBox.style.width = `${width}px`;
                cropBox.style.height = `${height}px`;
            }
            
            function startDrag(e) {
                if (e.target === cropBox) {
                    isDragging = true;
                    startX = e.clientX || e.touches[0].clientX;
                    startY = e.clientY || e.touches[0].clientY;
                    startLeft = parseInt(cropBox.style.left || '0');
                    startTop = parseInt(cropBox.style.top || '0');
                    cropBox.style.cursor = 'grabbing';
                    e.preventDefault();
                }
            }
            
            function startResize(e) {
                isResizing = true;
                activeHandle = e.target;
                startX = e.clientX || e.touches[0].
